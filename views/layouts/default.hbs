<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Mi prestamito</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">        <link rel="stylesheet" href="/sweetalert2/sweetalert2.css">
        <link rel="stylesheet" href="/sweetalert2/sweetalert2.css">
        <link href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    </head>
<body>
<nav class="navbar navbar-expand-lg bg-light">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="" id="divnavbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">

                    <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/Portal">Mi Prestamito</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/Portal">Inicio</a>
                </li>
                
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#">Vision</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="#">Mision</a>
                    </li>


                    <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/login">Iniciar sesi√≥n</a>
                </li>

                </ul>
            </div>
            <div class="">
                <div style="display: none" id="divnavbarSupporteMenu">

                        <ul id="menu" class=" navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Catalogos
                                </a>
                                <div class="dropdown-menu" >
                                    <a class="dropdown-item" href="/puntoatencion">Punto de atencion</a>
                                    <a class="dropdown-item" href="/usuario-p-a">Usuario punto de atencion</a>
                                    <a class="dropdown-item" href="/tipoqueja">Tipo de quejas</a>
                                </div>
                            </li>

                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle"  href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Quejas
                                </a>
                                <div class="dropdown-menu" id="dropQuejas" >

                                </div>
                            </li>

                           <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle"  href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                   Ingreso de queja por mal servicio - CA
                                </a>
                                <div class="dropdown-menu" id="dropQuejass" >
                                <a class="dropdown-item" href="/auto_consulta">Consulta Estado de Queja.</a>


                                </div>

                            </li>

                            <li class="nav-item">
                                <a class="nav-link" aria-current="queja-proceso" href="/quejai">Quejas ingresadas por mal servicio</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="seguimiento" href="/usuario-atencion">Seguimiento Quejas por mal servicio asignadas</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="/reporte">Reporte</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="/tipo-queja">Administrar</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="/auto_consulta">Autoconsulta</a>
                            </li>
                        </ul>
                </div>  
            </div>
        </div>
    </div>
</nav>
    <div class="mt-3">
        {{{ body }}}
    </div>
    <div class="mt-5"></div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="/sweetalert2/sweetalert2.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>


</body>
</html>
<script>
    document.addEventListener('DOMContentLoaded', async function(){
        let jwt = localStorage.jwt;
        const header = new Headers();
        header.append('authorization', `Bearer ${jwt}`)
        header.append('Accept', `application/json`)
        header.append('Content-Type', `application/json`)

        await tipoQuejasDr();
             await tipoQuejasDrr();

    });

    tipoQuejasDr = async () => {
        let jwt = localStorage.jwt;
        const header = new Headers();
        header.append('authorization', `Bearer ${jwt}`)
        header.append('Accept', `application/json`)
        header.append('Content-Type', `application/json`)

        const response = await fetch('/api/tipo_queja/obtenerTipoQueja', {
            method:"GET",
            headers:header,
        }).then(res => res.json().then(data => ({status: res.status, body: data})));


        let statusCode = response.status;
        let body = response.body;
        let drop = ``;

        if (statusCode == 200){
            let resultadoConsulta = body.resultadoConsulta;
            resultadoConsulta.forEach(e => {
                let descripcion = e.Descripcion;
                let Siglas = e.Siglas;
                let Id_Tqueja = e.Id_Tqueja;

                drop += `
                    <a class="dropdown-item" href="/queja?sigla=${Id_Tqueja}">${descripcion}</a>

                `;
            });
            document.getElementById('dropQuejas').insertAdjacentHTML('beforeend', drop);

        }else{
            Swal.fire({
                icon: 'error',
                text: 'Hubo un error en obtener listado',
            });
        }
    }


    
    tipoQuejasDrr = async () => {
        let jwt = localStorage.jwt;
        const header = new Headers();
        header.append('authorization', `Bearer ${jwt}`)
        header.append('Accept', `application/json`)
        header.append('Content-Type', `application/json`)

        const response = await fetch('/api/tipo_queja/obtenerTipoQueja', {
            method:"GET",
            headers:header,
        }).then(res => res.json().then(data => ({status: res.status, body: data})));


        let statusCode = response.status;
        let body = response.body;
        let drop = ``;

        if (statusCode == 200){
            let resultadoConsulta = body.resultadoConsulta;
            resultadoConsulta.forEach(e => {
                let descripcion = e.Descripcion;
                let Siglas = e.Siglas;
                let Id_Tqueja = e.Id_Tqueja;

                drop += `
                    <a class="dropdown-item" href="/queja?sigla=${Id_Tqueja}">${descripcion}</a>

                `;
            });
            document.getElementById('dropQuejass').insertAdjacentHTML('beforeend', drop);

        }else{
            Swal.fire({
                icon: 'error',
                text: 'Hubo un error en obtener listado',
            });
        }
    }

</script>